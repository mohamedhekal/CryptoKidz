#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
CryptoKidz - Ø§Ø³ØªÙƒØ´Ø§Ù Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†
Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
"""

import tkinter as tk
from tkinter import ttk, messagebox
import json
import os
from ui.main_window import MainWindow
from data.progress_manager import ProgressManager

class CryptoKidzApp:
    def __init__(self):
        self.root = tk.Tk()
        self.root.title("ğŸ§  CryptoKidz - Ø§Ø³ØªÙƒØ´Ø§Ù Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†")
        self.root.geometry("1200x800")
        self.root.configure(bg='#FFE5E5')  # Ù„ÙˆÙ† ÙˆØ±Ø¯ÙŠ ÙØ§ØªØ­ Ù„Ù„Ø£Ø·ÙØ§Ù„
        
        # ØªØ¹ÙŠÙŠÙ† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        try:
            self.root.iconbitmap('assets/icon.ico')
        except:
            pass
        
        # ØªÙ‡ÙŠØ¦Ø© Ù…Ø¯ÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù…
        self.progress_manager = ProgressManager()
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        self.main_window = MainWindow(self.root, self.progress_manager)
        
        # ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
        self.root.minsize(1000, 700)
        
        # ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø©
        self.center_window()
        
    def center_window(self):
        """ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©"""
        self.root.update_idletasks()
        width = self.root.winfo_width()
        height = self.root.winfo_height()
        x = (self.root.winfo_screenwidth() // 2) - (width // 2)
        y = (self.root.winfo_screenheight() // 2) - (height // 2)
        self.root.geometry(f'{width}x{height}+{x}+{y}')
    
    def run(self):
        """ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"""
        try:
            self.root.mainloop()
        except KeyboardInterrupt:
            print("\nØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…")
        except Exception as e:
            messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: {str(e)}")
        finally:
            # Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
            self.progress_manager.save_progress()

def main():
    """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"""
    print("ğŸš€ Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ CryptoKidz...")
    print("ğŸ± Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…Ù…ØªØ¹!")
    
    app = CryptoKidzApp()
    app.run()

if __name__ == "__main__":
    main() 